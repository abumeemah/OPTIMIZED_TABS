{% extends "base.html" %}
{% block title %}{{ t('budget_create_budget', default='Create Budget') }}{% endblock %}
{% block content %}
<div class="container mt-4">
    {% set tool_name = 'budget_create_budget' %}
    {% set tool_icon = 'fa-plus-circle' %}
    {% set subtitle = t('budget_create_description', default='Plan your monthly income and expenses to achieve your financial goals') %}
    {% include 'tool_header.html' %}

    <!-- Navigation Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('budget.index') }}">{{ t('budget_title', default='Budget Planner') }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ t('budget_create_budget', default='Create Budget') }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">
            <form method="POST" action="{{ url_for('budget.new') }}" id="budgetForm" class="validate-form">
                {{ form.csrf_token }}
                <input type="hidden" name="action" value="create_budget">

                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-money-bill-wave me-2"></i>{{ t('budget_monthly_income', default='Monthly Income') }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.income.id }}" class="form-label">{{ t('budget_monthly_income', default='Monthly Income') }}</label>
                            {{ form.income(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="500000.00", required=True, value=form.income.data or '') }}
                            <div class="invalid-feedback">{{ t('budget_income_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                            <small id="income_help" class="form-text text-muted">{{ t('budget_income_help', default='Enter your monthly income (e.g., 500000.00)') }}</small>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-warning text-white">
                        <h5><i class="fas fa-receipt me-2"></i>{{ t('budget_expenses', default='Monthly Expenses') }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.housing.id }}" class="form-label">{{ t('budget_housing_rent', default='Housing/Rent') }}</label>
                                {{ form.housing(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="100000.00", required=True, value=form.housing.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_housing_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                                <small id="housing_help" class="form-text text-muted">{{ t('budget_housing_help', default='Enter housing cost (e.g., 100000.00)') }}</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.food.id }}" class="form-label">{{ t('budget_food', default='Food') }}</label>
                                {{ form.food(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="50000.00", required=True, value=form.food.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_food_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                                <small id="food_help" class="form-text text-muted">{{ t('budget_food_help', default='Enter food cost (e.g., 50000.00)') }}</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.transport.id }}" class="form-label">{{ t('budget_transport', default='Transport') }}</label>
                                {{ form.transport(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="20000.00", required=True, value=form.transport.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_transport_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                                <small id="transport_help" class="form-text text-muted">{{ t('budget_transport_help', default='Enter transport cost (e.g., 20000.00)') }}</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.dependents.id }}" class="form-label">{{ t('budget_dependents_support', default='Dependents Support') }}</label>
                                {{ form.dependents(class="form-control", type="number", min="0", max="100", step="1", placeholder="3", required=True, value=form.dependents.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_dependents_invalid', default='Please enter a valid integer between 0 and 100') }}</div>
                                <small id="dependents_help" class="form-text text-muted">{{ t('budget_dependents_help', default='Enter number of dependents (e.g., 3)') }}</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.miscellaneous.id }}" class="form-label">{{ t('budget_miscellaneous', default='Miscellaneous') }}</label>
                                {{ form.miscellaneous(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="10000.00", required=True, value=form.miscellaneous.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_miscellaneous_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                                <small id="miscellaneous_help" class="form-text text-muted">{{ t('budget_miscellaneous_help', default='Enter miscellaneous cost (e.g., 10000.00)') }}</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.others.id }}" class="form-label">{{ t('budget_others', default='Others') }}</label>
                                {{ form.others(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="15000.00", required=True, value=form.others.data or '') }}
                                <div class="invalid-feedback">{{ t('budget_others_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                                <small id="others_help" class="form-text text-muted">{{ t('budget_others_help', default='Enter other expenses (e.g., 15000.00)') }}</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5><i class="fas fa-piggy-bank me-2"></i>{{ t('budget_savings_goal', default='Savings Goal') }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.savings_goal.id }}" class="form-label">{{ t('budget_savings_goal', default='Monthly Savings Goal') }}</label>
                            {{ form.savings_goal(class="form-control", type="number", min="0", max="10000000000", step="0.01", placeholder="50000.00", required=True, value=form.savings_goal.data or '') }}
                            <div class="invalid-feedback">{{ t('budget_savings_goal_invalid', default='Please enter a valid number between 0 and 10 billion') }}</div>
                            <small id="savings_goal_help" class="form-text text-muted">{{ t('budget_savings_goal_help', default='Enter your monthly savings goal (e.g., 50000.00)') }}</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between">
                    <a href="{{ url_for('budget.index') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>{{ t('general_back', default='Back') }}
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-calculator me-2"></i>{{ t('budget_calculate_budget', default='Calculate Budget') }}
                    </button>
                </div>
            </form>
        </div>

        <div class="col-lg-4">
            <!-- Tips Sidebar -->
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>{{ t('budget_tips', default='Tips') }}</h6>
                </div>
                <div class="card-body">
                    {% if tips %}
                        <ul class="list-unstyled">
                            {% for tip in tips %}
                                <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>{{ t(tip, default=tip) }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <ul class="list-unstyled">
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>{{ t('budget_tip_track_expenses', default='Track your expenses daily to stay within budget') }}</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>{{ t('budget_tip_ajo_savings', default='Contribute to ajo savings for financial discipline') }}</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>{{ t('budget_tip_data_subscriptions', default='Optimize data subscriptions to reduce costs') }}</li>
                            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>{{ t('budget_tip_plan_dependents', default='Plan for dependents\' expenses in advance') }}</li>
                        </ul>
                    {% endif %}
                </div>
            </div>

            <!-- Recent Activity -->
            {% if activities %}
                <div class="card shadow-sm mt-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0"><i class="fas fa-clock me-2"></i>{{ t('general_recent_activity', default='Recent Activity') }}</h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for activity in activities[:5] %}
                                <div class="list-group-item border-0 px-0">
                                    <small class="text-muted">{{ activity.timestamp | format_datetime }}</small>
                                    <div>{{ activity.description }}</div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Simple form validation using HTML5 native validation
    const form = document.getElementById('budgetForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            if (!form.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
                
                // Find first invalid field and focus it
                const firstInvalid = form.querySelector(':invalid');
                if (firstInvalid) {
                    firstInvalid.focus();
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            form.classList.add('was-validated');
        });
        
        // Add real-time validation feedback
        const inputs = form.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.checkValidity()) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            });
        });
    }
});
</script>
{% endblock %}